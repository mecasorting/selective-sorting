<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<title>Tri Sélectif - Mode Admin</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #f4f4f4;
    padding: 20px;
  }
  h1 {
    text-align: center;
    margin-bottom: 30px;
  }
  .bin {
    background: white;
    padding: 15px 20px;
    margin-bottom: 25px;
    border-radius: 6px;
    box-shadow: 0 0 5px #ccc;
    display: flex;
    align-items: flex-start;
    gap: 15px;
    position: relative;
  }
  .bin img {
    width: 80px;
    height: 80px;
    object-fit: cover;
    border-radius: 8px;
    cursor: default;
  }
  .bin-content {
    flex-grow: 1;
  }
  .bin h2 {
    margin: 0 0 10px;
  }
  ul {
    padding-left: 20px;
    margin: 0 0 15px;
  }
  li {
    margin-bottom: 5px;
  }
  form.add-item-form {
    display: none;
    gap: 8px;
  }
  form.add-item-form.visible {
    display: flex;
  }
  form.add-item-form input[type="text"] {
    flex-grow: 1;
    padding: 6px 8px;
  }
  form.add-item-form button {
    padding: 6px 12px;
    cursor: pointer;
  }
  #exportBtn, #addBinBtn, #importBtn {
    display: none;
    margin: 10px 10px 0 0;
    padding: 10px 20px;
    font-size: 16px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    color: white;
  }
  #exportBtn { background: #4caf50; }
  #addBinBtn { background: #2196f3; }
  #importBtn { background: #ff9800; }
  #adminBtn {
    margin: 10px 10px 0 0;
    padding: 10px 20px;
    font-size: 16px;
    background: #f44336;
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
  }
  /* Popup modale mot de passe */
  #passwordModal {
    position: fixed;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    background: white;
    padding: 20px 30px;
    box-shadow: 0 0 10px #222;
    border-radius: 8px;
    z-index: 1001;
    display: none;
    width: 320px;
  }
  #passwordModal label {
    display: block;
    margin-bottom: 8px;
    font-weight: bold;
  }
  #passwordModal input {
    width: 100%;
    padding: 8px;
    font-size: 16px;
    margin-bottom: 12px;
  }
  #passwordModal button {
    padding: 8px 16px;
    margin-right: 8px;
    font-size: 14px;
    cursor: pointer;
  }
  /* Overlay modale */
  #overlay {
    position: fixed;
    top:0; left:0; right:0; bottom:0;
    background: rgba(0,0,0,0.5);
    z-index: 1000;
    display: none;
  }
  /* Popup changement image */
  #imagePrompt {
    position: fixed;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    background: white;
    padding: 20px 25px;
    box-shadow: 0 0 10px #222;
    border-radius: 8px;
    z-index: 1002;
    display: none;
    width: 320px;
  }
  #imagePrompt label {
    display: block;
    margin-bottom: 8px;
    font-weight: bold;
  }
  #imagePrompt input {
    width: 100%;
    margin-bottom: 10px;
    padding: 6px;
  }
  #imagePrompt button {
    padding: 6px 12px;
    margin-right: 8px;
    cursor: pointer;
  }
</style>
</head>
<body>

<h1>Tri Sélectif</h1>

<div id="binsContainer">
  <div class="bin" data-name="Verre">
    <img src="https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=80&q=80" alt="Verre" title="Cliquez pour changer l'image" />
    <div class="bin-content">
      <h2>Verre</h2>
      <ul class="item-list">
        <li>Bouteilles</li>
        <li>Flacons</li>
        <li>Vases</li>
      </ul>
      <form class="add-item-form">
        <input type="text" placeholder="Ajouter un objet..." required />
        <button type="submit">Ajouter</button>
      </form>
    </div>
  </div>

  <div class="bin" data-name="Plastique">
    <img src="https://images.unsplash.com/photo-1501004318641-b39e6451bec6?auto=format&fit=crop&w=80&q=80" alt="Plastique" title="Cliquez pour changer l'image" />
    <div class="bin-content">
      <h2>Plastique</h2>
      <ul class="item-list">
        <li>Bidons</li>
        <li>Sacs plastiques</li>
        <li>Barquettes</li>
      </ul>
      <form class="add-item-form">
        <input type="text" placeholder="Ajouter un objet..." required />
        <button type="submit">Ajouter</button>
      </form>
    </div>
  </div>

  <div class="bin" data-name="Papier">
    <img src="https://images.unsplash.com/photo-1518976024611-26a7a5f52db6?auto=format&fit=crop&w=80&q=80" alt="Papier" title="Cliquez pour changer l'image" />
    <div class="bin-content">
      <h2>Papier</h2>
      <ul class="item-list">
        <li>Journaux</li>
        <li>Cartons</li>
        <li>Publicités</li>
      </ul>
      <form class="add-item-form">
        <input type="text" placeholder="Ajouter un objet..." required />
        <button type="submit">Ajouter</button>
      </form>
    </div>
  </div>
</div>

<button id="exportBtn">Exporter le site complet</button>
<button id="addBinBtn">Ajouter une poubelle</button>
<button id="importBtn">Importer un fichier</button>
<button id="adminBtn">Mode Admin</button>
<input type="file" id="importFileInput" accept=".html" style="display:none" />

<!-- Modal Mot de passe -->
<div id="overlay"></div>

<div id="passwordModal">
  <label for="adminPasswordInput">Entrez le mot de passe admin :</label>
  <input id="adminPasswordInput" type="password" autocomplete="off" />
  <div>
    <button id="passwordOkBtn">OK</button>
    <button id="passwordCancelBtn">Annuler</button>
  </div>
</div>

<!-- Popup changement image -->
<div id="imagePrompt">
  <label for="imageUrlInput">Nouvelle URL de l'image :</label>
  <input type="text" id="imageUrlInput" placeholder="https://exemple.com/image.jpg" />
  <div>
    <button id="saveImageBtn">Sauvegarder</button>
    <button id="cancelImageBtn">Annuler</button>
  </div>
</div>

<script>
(() => {
  const adminPassword = "secret123"; // Change ton mdp ici !
  let adminMode = false;
  let currentImageToChange = null;

  const binsContainer = document.getElementById('binsContainer');
  const exportBtn = document.getElementById('exportBtn');
  const adminBtn = document.getElementById('adminBtn');
  const addBinBtn = document.getElementById('addBinBtn');
  const importBtn = document.getElementById('importBtn');
  const importFileInput = document.getElementById('importFileInput');

  const passwordModal = document.getElementById('passwordModal');
  const overlay = document.getElementById('overlay');
  const adminPasswordInput = document.getElementById('adminPasswordInput');
  const passwordOkBtn = document.getElementById('passwordOkBtn');
  const passwordCancelBtn = document.getElementById('passwordCancelBtn');

  const imagePrompt = document.getElementById('imagePrompt');
  const imageUrlInput = document.getElementById('imageUrlInput');
  const saveImageBtn = document.getElementById('saveImageBtn');
  const cancelImageBtn = document.getElementById('cancelImageBtn');

  // Au départ on masque les boutons admin
  function updateUI() {
    if(adminMode) {
      exportBtn.style.display = 'inline-block';
      addBinBtn.style.display = 'inline-block';
      importBtn.style.display = 'inline-block';
      adminBtn.textContent = 'Quitter mode Admin';
      // Afficher formulaires ajout d'objet et changer curseur image
      document.querySelectorAll('.add-item-form').forEach(form => form.classList.add('visible'));
      document.querySelectorAll('.bin img').forEach(img => {
        img.style.cursor = 'pointer';
      });
    } else {
      exportBtn.style.display = 'none';
      addBinBtn.style.display = 'none';
      importBtn.style.display = 'inline-block';
      adminBtn.textContent = 'Mode Admin';
      // Cacher formulaires ajout d'objet et remettre curseur normal
      document.querySelectorAll('.add-item-form').forEach(form => form.classList.remove('visible'));
      document.querySelectorAll('.bin img').forEach(img => {
        img.style.cursor = 'default';
      });
      hideImagePrompt();
    }
  }

  // Affiche la modal de mot de passe
  function showPasswordModal() {
    passwordModal.style.display = 'block';
    overlay.style.display = 'block';
    adminPasswordInput.value = '';
    adminPasswordInput.focus();
  }
  // Cache la modal mot de passe
  function hidePasswordModal() {
    passwordModal.style.display = 'none';
    overlay.style.display = 'none';
  }

  // Toggle mode admin
  function toggleAdminMode() {
    if (!adminMode) {
      showPasswordModal();
    } else {
      adminMode = false;
      updateUI();
    }
  }

  adminBtn.addEventListener('click', toggleAdminMode);

  passwordOkBtn.addEventListener('click', () => {
    const val = adminPasswordInput.value.trim();
    if(val === adminPassword) {
      adminMode = true;
      updateUI();
      hidePasswordModal();
    } else {
      alert('Mot de passe incorrect !');
      adminPasswordInput.value = '';
      adminPasswordInput.focus();
    }
  });

  passwordCancelBtn.addEventListener('click', () => {
    hidePasswordModal();
  });

  overlay.addEventListener('click', () => {
    // Si modal ouverte, on la ferme au clic sur overlay
    if(passwordModal.style.display === 'block') {
      hidePasswordModal();
    }
    if(imagePrompt.style.display === 'block') {
      hideImagePrompt();
    }
  });

  // Formulaires ajout objets dans poubelles
  function setupAddItemForms() {
    binsContainer.querySelectorAll('.add-item-form').forEach(form => {
      form.addEventListener('submit', e => {
        e.preventDefault();
        const input = form.querySelector('input');
        const val = input.value.trim();
        if (!val) return;
        const ul = form.parentElement.querySelector('.item-list');
        const li = document.createElement('li');
        li.textContent = val;
        ul.appendChild(li);
        input.value = '';
      });
    });
  }

  setupAddItemForms();

  // Changer image au clic si mode admin
  binsContainer.addEventListener('click', e => {
    if (!adminMode) return;
    if (e.target.tagName === 'IMG' && e.target.closest('.bin')) {
      currentImageToChange = e.target;
      showImagePrompt(currentImageToChange.src);
    }
  });

  function showImagePrompt(currentUrl) {
    imageUrlInput.value = currentUrl;
    imagePrompt.style.display = 'block';
    overlay.style.display = 'block';
    imageUrlInput.focus();
  }
  function hideImagePrompt() {
    imagePrompt.style.display = 'none';
    overlay.style.display = 'none';
    currentImageToChange = null;
  }
  saveImageBtn.addEventListener('click', () => {
    const url = imageUrlInput.value.trim();
    if(url && currentImageToChange) {
      currentImageToChange.src = url;
    }
    hideImagePrompt();
  });
  cancelImageBtn.addEventListener('click', () => {
    hideImagePrompt();
  });

  // Ajouter une nouvelle poubelle
  addBinBtn.addEventListener('click', () => {
    const binName = prompt("Nom de la nouvelle poubelle ?");
    if(!binName) return;
    const imgUrl = prompt("URL de l'image pour cette poubelle ?");
    if(!imgUrl) return;

    // Créer nouvelle poubelle
    const div = document.createElement('div');
    div.className = 'bin';
    div.setAttribute('data-name', binName);
    div.innerHTML = `
      <img src="${imgUrl}" alt="${binName}" title="Cliquez pour changer l'image" />
      <div class="bin-content">
        <h2>${binName}</h2>
        <ul class="item-list"></ul>
        <form class="add-item-form visible">
          <input type="text" placeholder="Ajouter un objet..." required />
          <button type="submit">Ajouter</button>
        </form>
      </div>
    `;
    binsContainer.appendChild(div);

    // Ajouter event formulaire ajout objet
    div.querySelector('form.add-item-form').addEventListener('submit', e => {
      e.preventDefault();
      const input = e.target.querySelector('input');
      const val = input.value.trim();
      if(!val) return;
      const ul = e.target.parentElement.querySelector('.item-list');
      const li = document.createElement('li');
      li.textContent = val;
      ul.appendChild(li);
      input.value = '';
    });

    // L'image est clickable directement (car admin mode)
    div.querySelector('img').style.cursor = 'pointer';
  });

  // Exporter le site complet (HTML + CSS + JS + contenu dynamique)
  exportBtn.addEventListener('click', () => {
    // Construire le HTML exporté
    const doctype = '<!DOCTYPE html>\n';
    const html = document.documentElement.outerHTML;

    // Créer blob avec le HTML complet
    const blob = new Blob([doctype + html], {type: 'text/html'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'tri-selectif-export.html';
    a.click();
    URL.revokeObjectURL(url);
  });

  // Importer un fichier HTML exporté
  importBtn.addEventListener('click', () => {
    importFileInput.click();
  });

  importFileInput.addEventListener('change', e => {
    const file = importFileInput.files[0];
    if(!file) return;

    const reader = new FileReader();
    reader.onload = function(ev) {
      const text = ev.target.result;

      // Parse HTML du fichier importé
      const parser = new DOMParser();
      const importedDoc = parser.parseFromString(text, 'text/html');

      // Récupérer les poubelles du fichier importé
      const importedBins = importedDoc.getElementById('binsContainer');
      if(!importedBins) {
        alert('Fichier invalide : pas de conteneur de poubelles trouvé.');
        return;
      }

      // Remplacer les poubelles actuelles par celles importées
      binsContainer.innerHTML = importedBins.innerHTML;

      // Réinitialiser admin mode
      adminMode = false;
      updateUI();

      // Reconnecter les événements sur nouveaux éléments
      setupAddItemForms();

      alert('Import réussi ! Mode admin désactivé.');
    };
    reader.readAsText(file);
    importFileInput.value = ''; // reset input
  });

  updateUI();

})();
</script>

</body>
</html>

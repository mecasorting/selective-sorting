<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<title>Tri Sélectif - Mode Admin</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #f4f4f4;
    padding: 20px;
  }
  h1 {
    text-align: center;
    margin-bottom: 30px;
  }
  .bin {
    background: white;
    padding: 15px 20px;
    margin-bottom: 25px;
    border-radius: 6px;
    box-shadow: 0 0 5px #ccc;
    display: flex;
    align-items: flex-start;
    gap: 15px;
    position: relative;
  }
  .bin img {
    width: 80px;
    height: 80px;
    object-fit: cover;
    border-radius: 8px;
    cursor: default;
  }
  .bin-content {
    flex-grow: 1;
  }
  .bin h2 {
    margin: 0 0 10px;
  }
  ul {
    padding-left: 20px;
    margin: 0 0 15px;
  }
  li {
    margin-bottom: 5px;
  }
  form.add-item-form {
    display: flex;
    gap: 8px;
  }
  form.add-item-form input[type="text"] {
    flex-grow: 1;
    padding: 6px 8px;
  }
  form.add-item-form button {
    padding: 6px 12px;
    cursor: pointer;
  }
  #exportBtn, #addBinBtn {
    display: none; /* cachés par défaut */
    margin: 10px 10px 0 0;
    padding: 10px 20px;
    font-size: 16px;
    background: #4caf50;
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
  }
  #addBinBtn {
    background: #2196f3;
  }
  #exportBtn.visible, #addBinBtn.visible {
    display: inline-block; /* affichés quand la classe visible est ajoutée */
  }
  .hidden {
    display: none;
  }
  /* Style du popup changement image */
  #imagePrompt {
    position: fixed;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    background: white;
    padding: 20px;
    box-shadow: 0 0 10px #222;
    border-radius: 8px;
    z-index: 999;
  }
  #imagePrompt input {
    width: 100%;
    margin-bottom: 10px;
    padding: 6px;
  }
  #imagePrompt button {
    padding: 6px 12px;
    margin-right: 8px;
  }
  #overlay {
    position: fixed;
    top:0; left:0; right:0; bottom:0;
    background: rgba(0,0,0,0.5);
    z-index: 998;
  }

  /* Popup modale mot de passe */
  #passwordModal {
    position: fixed;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    background: white;
    padding: 25px 30px;
    box-shadow: 0 0 15px #0008;
    border-radius: 10px;
    z-index: 1000;
    width: 320px;
  }
  #passwordModal.hidden {
    display: none;
  }
  #passwordModal label {
    display: block;
    margin-bottom: 8px;
    font-weight: bold;
    font-size: 1.1em;
  }
  #passwordModal input[type="password"] {
    width: 100%;
    padding: 8px 10px;
    font-size: 1em;
    margin-bottom: 15px;
    border: 2px solid #ddd;
    border-radius: 6px;
  }
  #passwordModal button {
    padding: 8px 16px;
    font-size: 1em;
    cursor: pointer;
    border-radius: 6px;
    border: none;
  }
  #passwordModal #passwordSubmit {
    background-color: #4caf50;
    color: white;
    margin-right: 10px;
  }
  #passwordModal #passwordCancel {
    background-color: #f44336;
    color: white;
  }

</style>
</head>
<body>

<h1>Tri Sélectif</h1>

<div id="binsContainer">
  <div class="bin" data-name="Verre">
    <img src="https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=80&q=80" alt="Verre" title="Cliquez pour changer l'image" />
    <div class="bin-content">
      <h2>Verre</h2>
      <ul class="item-list">
        <li>Bouteilles</li>
        <li>Flacons</li>
        <li>Vases</li>
      </ul>
      <form class="add-item-form hidden">
        <input type="text" placeholder="Ajouter un objet..." required />
        <button type="submit">Ajouter</button>
      </form>
    </div>
  </div>

  <div class="bin" data-name="Plastique">
    <img src="https://images.unsplash.com/photo-1501004318641-b39e6451bec6?auto=format&fit=crop&w=80&q=80" alt="Plastique" title="Cliquez pour changer l'image" />
    <div class="bin-content">
      <h2>Plastique</h2>
      <ul class="item-list">
        <li>Bidons</li>
        <li>Sacs plastiques</li>
        <li>Barquettes</li>
      </ul>
      <form class="add-item-form hidden">
        <input type="text" placeholder="Ajouter un objet..." required />
        <button type="submit">Ajouter</button>
      </form>
    </div>
  </div>

  <div class="bin" data-name="Papier">
    <img src="https://images.unsplash.com/photo-1518976024611-26a7a5f52db6?auto=format&fit=crop&w=80&q=80" alt="Papier" title="Cliquez pour changer l'image" />
    <div class="bin-content">
      <h2>Papier</h2>
      <ul class="item-list">
        <li>Journaux</li>
        <li>Cartons</li>
        <li>Publicités</li>
      </ul>
      <form class="add-item-form hidden">
        <input type="text" placeholder="Ajouter un objet..." required />
        <button type="submit">Ajouter</button>
      </form>
    </div>
  </div>
</div>

<button id="exportBtn">Exporter le site complet</button>
<button id="adminBtn">Mode Admin</button>
<button id="addBinBtn">Ajouter une poubelle</button>

<!-- Popup changement image -->
<div id="overlay" class="hidden"></div>
<div id="imagePrompt" class="hidden">
  <label for="imageUrlInput">Nouvelle URL de l'image :</label>
  <input type="text" id="imageUrlInput" placeholder="https://exemple.com/image.jpg" />
  <div>
    <button id="saveImageBtn">Sauvegarder</button>
    <button id="cancelImageBtn">Annuler</button>
  </div>
</div>

<!-- Popup modale mot de passe -->
<div id="passwordModal" class="hidden">
  <label for="adminPasswordInput">Mot de passe admin :</label>
  <input type="password" id="adminPasswordInput" placeholder="Saisissez le mot de passe" />
  <div>
    <button id="passwordSubmit">Valider</button>
    <button id="passwordCancel">Annuler</button>
  </div>
</div>

<script>
(() => {
  const adminPassword = "secret123"; // Change ton mdp ici !
  let adminMode = false;
  let currentImageToChange = null;

  const binsContainer = document.getElementById('binsContainer');
  const exportBtn = document.getElementById('exportBtn');
  const adminBtn = document.getElementById('adminBtn');
  const addBinBtn = document.getElementById('addBinBtn');
  const imagePrompt = document.getElementById('imagePrompt');
  const overlay = document.getElementById('overlay');
  const imageUrlInput = document.getElementById('imageUrlInput');
  const saveImageBtn = document.getElementById('saveImageBtn');
  const cancelImageBtn = document.getElementById('cancelImageBtn');

  const passwordModal = document.getElementById('passwordModal');
  const adminPasswordInput = document.getElementById('adminPasswordInput');
  const passwordSubmit = document.getElementById('passwordSubmit');
  const passwordCancel = document.getElementById('passwordCancel');

  // Initial setup: cacher boutons export et add bin
  exportBtn.classList.remove('visible');
  addBinBtn.classList.remove('visible');
  document.querySelectorAll('.add-item-form').forEach(form => form.classList.add('hidden'));

  // Ouvre la modale mot de passe
  function openPasswordModal() {
    adminPasswordInput.value = "";
    passwordModal.classList.remove('hidden');
    overlay.classList.remove('hidden');
    adminPasswordInput.focus();
  }

  // Ferme la modale mot de passe
  function closePasswordModal() {
    passwordModal.classList.add('hidden');
    overlay.classList.add('hidden');
  }

  // Gérer clic sur bouton mode admin
  adminBtn.addEventListener('click', () => {
    if (!adminMode) {
      openPasswordModal();
    } else {
      // Quitter mode admin
      adminMode = false;
      adminBtn.textContent = "Mode Admin";
      exportBtn.classList.remove('visible');
      addBinBtn.classList.remove('visible');
      document.querySelectorAll('.add-item-form').forEach(form => form.classList.add('hidden'));
      document.querySelectorAll('.bin img').forEach(img => {
        img.style.cursor = 'default';
      });
      hideImagePrompt();
    }
  });

  // Validation mdp
  passwordSubmit.addEventListener('click', () => {
    const val = adminPasswordInput.value;
    if (val === adminPassword) {
      adminMode = true;
      adminBtn.textContent = "Quitter mode Admin";
      exportBtn.classList.add('visible');
      addBinBtn.classList.add('visible');
      document.querySelectorAll('.add-item-form').forEach(form => form.classList.remove('hidden'));
      document.querySelectorAll('.bin img').forEach(img => {
        img.style.cursor = 'pointer';
      });
      closePasswordModal();
    } else {
      alert("Mot de passe incorrect !");
      adminPasswordInput.value = "";
      adminPasswordInput.focus();
    }
  });

  // Annuler mdp
  passwordCancel.addEventListener('click', () => {
    closePasswordModal();
  });

  // Fermer modale si clic hors
  overlay.addEventListener('click', () => {
    if (!passwordModal.classList.contains('hidden')) closePasswordModal();
    if (!imagePrompt.classList.contains('hidden')) hideImagePrompt();
  });

  // Ajouter un objet dans liste
  function setupAddItemForms() {
    binsContainer.querySelectorAll('.add-item-form').forEach(form => {
      // Supprimer anciens handlers pour éviter doublons
      form.onsubmit = null;
      form.addEventListener('submit', e => {
        e.preventDefault();
        const input = form.querySelector('input');
        const val = input.value.trim();
        if (!val) return;
        const ul = form.parentElement.querySelector('.item-list');
        const li = document.createElement('li');
        li.textContent = val;
        ul.appendChild(li);
        input.value = '';
      });
    });
  }
  setupAddItemForms();

  // Changer image si mode admin
  binsContainer.addEventListener('click', e => {
    if (!adminMode) return;
    if (e.target.tagName === 'IMG' && e.target.closest('.bin')) {
      currentImageToChange = e.target;
      showImagePrompt(currentImageToChange.src);
    }
  });

  function showImagePrompt(currentUrl) {
    imageUrlInput.value = currentUrl;
    imagePrompt.classList.remove('hidden');
    overlay.classList.remove('hidden');
    imageUrlInput.focus();
  }
  function hideImagePrompt() {
    imagePrompt.classList.add('hidden');
    overlay.classList.add('hidden');
    currentImageToChange = null;
  }

  saveImageBtn.addEventListener('click', () => {
    const newUrl = imageUrlInput.value.trim();
    if (!newUrl) {
      alert("URL invalide !");
      return;
    }
    if (currentImageToChange) {
      currentImageToChange.src = newUrl;
    }
    hideImagePrompt();
  });

  cancelImageBtn.addEventListener('click', hideImagePrompt);

  // Ajouter une nouvelle poubelle
  addBinBtn.addEventListener('click', () => {
    if (!adminMode) return;
    const name = prompt("Nom de la nouvelle poubelle :");
    if (!name) return alert("Nom obligatoire !");
    const imageUrl = prompt("URL de l'image pour la poubelle :\n(Laisse vide pour image par défaut)");

    const binDiv = document.createElement('div');
    binDiv.className = 'bin';
    binDiv.setAttribute('data-name', name);

    const img = document.createElement('img');
    img.alt = name;
    img.title = "Cliquez pour changer l'image";
    img.src = imageUrl && imageUrl.trim() !== '' ? imageUrl.trim() : 'https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=80&q=80';

    const binContent = document.createElement('div');
    binContent.className = 'bin-content';

    const h2 = document.createElement('h2');
    h2.textContent = name;

    const ul = document.createElement('ul');
    ul.className = 'item-list';

    const form = document.createElement('form');
    form.className = 'add-item-form';

    const input = document.createElement('input');
    input.type = 'text';
    input.placeholder = 'Ajouter un objet...';
    input.required = true;

    const button = document.createElement('button');
    button.type = 'submit';
    button.textContent = 'Ajouter';

    form.appendChild(input);
    form.appendChild(button);

    binContent.appendChild(h2);
    binContent.appendChild(ul);
    binContent.appendChild(form);

    binDiv.appendChild(img);
    binDiv.appendChild(binContent);

    binsContainer.appendChild(binDiv);

    setupAddItemForms();
  });

  // Exporter le site complet (tout le HTML)
  exportBtn.addEventListener('click', () => {
    const htmlContent = `<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<title>Tri Sélectif Exporté</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #f4f4f4;
    padding: 20px;
  }
  h1 {
    text-align: center;
    margin-bottom: 30px;
  }
  .bin {
    background: white;
    padding: 15px 20px;
    margin-bottom: 25px;
    border-radius: 6px;
    box-shadow: 0 0 5px #ccc;
    display: flex;
    align-items: flex-start;
    gap: 15px;
  }
  .bin img {
    width: 80px;
    height: 80px;
    object-fit: cover;
    border-radius: 8px;
  }
  .bin-content {
    flex-grow: 1;
  }
  .bin h2 {
    margin: 0 0 10px;
  }
  ul {
    padding-left: 20px;
    margin: 0 0 15px;
  }
  li {
    margin-bottom: 5px;
  }
</style>
</head>
<body>
<h1>Tri Sélectif</h1>
${binsContainer.innerHTML}
</body>
</html>`;

    const blob = new Blob([htmlContent], {type: "text/html;charset=utf-8"});
    const url = URL.createObjectURL(blob);

    const a = document.createElement('a');
    a.href = url;
    a.download = "tri-selectif-export.html";
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  });

})();
</script>

</body>
</html>
